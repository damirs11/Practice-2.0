<div>
    <mat-card class="card-form">
        <form (ngSubmit)="createKey(form.value)" [formGroup]="form">
            <div formGroupName="keyMeta">

                <mat-form-field class="full-width">
                    <input formControlName="id" matInput placeholder="Идентификатор" type="text" readonly>
                </mat-form-field>

                <mat-form-field class="full-width" *ngIf="keyGenerationParams | async">
                    <input formControlName="previousLicense" matInput placeholder="Предыдущий Идентификатор лицензии" type="text" readonly>
                </mat-form-field>

                <mat-form-field class="full-width">
                    <input [matDatepicker]="dateOfIssue" formControlName="dateOfIssue"
                           matInput
                           placeholder="Дата выпуска" readonly>
                    <mat-datepicker #dateOfIssue></mat-datepicker>
                </mat-form-field>

                <mat-form-field class="full-width">
                    <input [matDatepicker]="dateOfExpiry" formControlName="dateOfExpiry"
                           matInput [min]="minDate"
                           placeholder="Срок действия">
                    <mat-datepicker-toggle [for]="dateOfExpiry" matSuffix></mat-datepicker-toggle>
                    <mat-datepicker #dateOfExpiry></mat-datepicker>

                    <mat-error>
                          <span *ngIf="!form.get('keyMeta.dateOfExpiry').valid && form.get('keyMeta.dateOfExpiry').touched">
                            Пожалуйста введите срок действия
                          </span>
                    </mat-error>
                </mat-form-field>

                <div formGroupName="properties">
                    <mat-form-field class="full-width">
                        <input [errorStateMatcher]="matcher" formControlName="organizationName" matInput placeholder="Организация" type="text">

                        <mat-error>
                          <span *ngIf="!form.get('keyMeta.properties.organizationName').valid && form.get('keyMeta.properties.organizationName').touched">
                            Пожалуйста введите имя
                          </span>
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field class="full-width">
                        <input [errorStateMatcher]="matcher" formControlName="coresCount" matInput min="1"
                               placeholder="Число ядер"
                               type="number">

                        <mat-error>
                          <span *ngIf="!form.get('keyMeta.properties.coresCount').valid && form.get('keyMeta.properties.coresCount').touched">
                            Пожалуйста введите количество ядер
                          </span>
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field class="full-width">
                        <input [errorStateMatcher]="matcher" formControlName="usersCount" matInput min="1"
                               placeholder="Число пользователей"
                               type="number">

                        <mat-error>
                          <span *ngIf="!form.get('keyMeta.properties.usersCount').valid && form.get('keyMeta.properties.usersCount').touched">
                            Пожалуйста введите количество пользователей
                          </span>
                        </mat-error>
                    </mat-form-field>

                    <div class="checkbox-group full-width" formGroupName="moduleFlags">
                        <mat-checkbox class="child" formControlName="platformOk">ПлатформаОк</mat-checkbox>
                        <mat-checkbox class="child" formControlName="EDS">СЭД</mat-checkbox>
                        <mat-checkbox class="child" formControlName="features">Фичи</mat-checkbox>
                        <mat-checkbox class="child" formControlName="archive">Архив (2017)</mat-checkbox>
                    </div>

                    <mat-form-field class="full-width">
                        <input [errorStateMatcher]="matcher" formControlName="keyFileName" matInput
                               placeholder="Название файла ключа"
                               type="text">

                        <mat-error>
                          <span *ngIf="!form.get('keyMeta.properties.keyFileName').valid && form.get('keyMeta.properties.keyFileName').touched">
                            Пожалуйста введите имя файла ключа
                          </span>
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field class="full-width">
                        <textarea [errorStateMatcher]="matcher" formControlName="comment" matInput placeholder="Комментарий"
                              type="text"></textarea>
                    </mat-form-field>
                </div>
            </div>

            <div formGroupName="files" *ngIf="(keyGenerationParams | async) === null">
                <mat-form-field class="full-width">
                    <ngx-mat-file-input #fileInput formControlName="activationKeyFile"
                                        placeholder="Файл активации"></ngx-mat-file-input>
                    <button (click)="fileInput.clear($event)" *ngIf="!fileInput.empty" mat-icon-button matSuffix>
                        <mat-icon matSuffix>clear</mat-icon>
                    </button>
                </mat-form-field>
            </div>

            <div class="generate-button">
                <button *ngIf="(keyGenerationParams | async) === null" class="app-button" [disabled]="!form.valid" color="primary" mat-flat-button
                        type="submit">
                    Выпустить
                </button>
                <button (click)="clearForm()" class="app-button" color="primary" mat-flat-button
                        type="button">
                    Очистить
                </button>
            </div>
        </form>
    </mat-card>
</div>
